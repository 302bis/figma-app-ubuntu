{"version":3,"file":"create-self-signed-cert.js","sourceRoot":"","sources":["../../src/cli/create-self-signed-cert.ts"],"names":[],"mappings":";;;;;;;;;;;;;AASA,AAAgB,AAChB,AAAM;;oEAAC,AAAK,WAA+B,AAAiB;AAC1D,cAAM,AAAM,SAAG,AAAI,AAAM,AAAE;AAC3B,cAAM,AAAS,YAAG,AAAO,QAAC,AAAG,AAAE;AAC/B,cAAM,AAAU,aAAG,AAAI,MAAC,AAAI,MAAC,MAAM,AAAM,OAAC,AAAU,AAAE,eAAE,AAAgB,6DAAC,AAAS,AAAC,AAAC;AACpF,cAAM,AAAG,AAAG,SAAG,AAAU,UAAM;AAC/B,cAAM,AAAG,AAAG,SAAG,AAAU,UAAM;AAE/B,AAAG,uDAAC,AAAK,kCAAC,AAAI,KAAC,AAAuF,AAAC,AAAC;AAExG,YAAI,AAAC;AACH,kBAAM,AAAS,+CAAC,AAAI,MAAC,AAAO,QAAC,AAAU,AAAC,AAAC;AACzC,kBAAM,AAAU,aAAG,AAAI,MAAC,AAAI,MAAC,MAAM,AAAiB,AAAE,yEAAE,AAAY,cAAE,AAAO,QAAC,AAAI,AAAC;AACnF,kBAAM,AAAI,gDAAC,AAAI,MAAC,AAAI,KAAC,AAAU,YAAE,AAAc,AAAC,iBAC9C,CAAC,AAAI,MAAE,AAAI,MAAE,AAAG,KAAE,AAAI,AAAE,YAAM,AAAW,qDAAC,AAAS,AAAC,UAAE,IAAE,AAAM,QAAE,AAAmB,qBAAE,AAAK,OAAE,AAAK,OAAE,AAAG,KAAE,AAAG,AAAC,AAAC;AAE/G,kBAAM,AAAG,MAAG,AAAI,MAAC,AAAI,KAAC,AAAS,AAAE,cAAG,AAAgB,6DAAC,AAAS,AAAC,UAAM,AAAC;AACtE,kBAAM,AAAc,wCAAC,AAAG,AAAC;AACzB,kBAAM,AAAI,gDAAC,AAAI,MAAC,AAAI,KAAC,AAAU,YAAE,AAAa,AAAC,gBAAE,CAAC,AAAM,QAAE,AAAG,KAAE,AAAM,QAAE,AAAG,KAAE,AAAM,QAAE,AAAG,AAAC,AAAC;AACzF,AAAG,AAAC,8DAAG,AAAG,GAAiF,AAAC;AAE5F,kBAAM,AAAY,eAAG,AAAoC;AACzD,AAAG,AAAC,8DAAG,AAAG,6BAA0B,AAAY,YAAsF,AAAC;AACvI,kBAAM,AAAK,iDAAC,AAAgB,kBAAE,CAAC,AAAuB,yBAAE,AAAW,AAAE,iBAAI,AAAG,GAAG,KAAE,AAAoB,sBAAE,AAAE,AAAC,AAAC,AAC7G;AAAC,kBACO,AAAC;AACP,kBAAM,AAAM,OAAC,AAAO,AAAE,AACxB;AAAC,AACH;AAAC;;;;;;;;;;;AArCD,AAAO,AAAE,AAAI,AAAE,AAAG,AAAE,AAAK,AAAE,AAAM,AAAE,AAAM,AAAc;;;;;;AACvD,AAAO,AAAE,AAAc,AAAE,AAAM,AAAqB;;;;;;AACpD,AAAO,AAAK,AAAM,AAAO;;;;;;AACzB,AAAO,AAAE,AAAS,AAAE,AAAM,AAAY;;;;AACtC,AAAO,AAAK,AAAI,AAAM,AAAM;;;;AAC5B,AAAO,AAAgB,AAAM,AAAmB;;;;;;AAChD,AAAO,AAAE,AAAW,AAAE,AAAM,AAAuB;;;;;;AACnD,AAAO,AAAE,AAAiB,AAAE,AAAM,AAAoB","sourcesContent":["import { exec, log, spawn, TmpDir } from \"builder-util\"\nimport { unlinkIfExists } from \"builder-util/out/fs\"\nimport chalk from \"chalk\"\nimport { ensureDir } from \"fs-extra-p\"\nimport * as path from \"path\"\nimport sanitizeFileName from \"sanitize-filename\"\nimport { quoteString } from \"../targets/AppxTarget\"\nimport { getSignVendorPath } from \"../windowsCodeSign\"\n\n/** @internal */\nexport async function createSelfSignedCert(publisher: string) {\n  const tmpDir = new TmpDir()\n  const targetDir = process.cwd()\n  const tempPrefix = path.join(await tmpDir.getTempDir(), sanitizeFileName(publisher))\n  const cer = `${tempPrefix}.cer`\n  const pvk = `${tempPrefix}.pvk`\n\n  log(chalk.bold('When asked to enter a password (\"Create Private Key Password\"), please select \"None\".'))\n\n  try {\n    await ensureDir(path.dirname(tempPrefix))\n    const vendorPath = path.join(await getSignVendorPath(), \"windows-10\", process.arch)\n    await exec(path.join(vendorPath, \"makecert.exe\"),\n      [\"-r\", \"-h\", \"0\", \"-n\", `CN=${quoteString(publisher)}`, \"-eku\", \"1.3.6.1.5.5.7.3.3\", \"-pe\", \"-sv\", pvk, cer])\n\n    const pfx = path.join(targetDir, `${sanitizeFileName(publisher)}.pfx`)\n    await unlinkIfExists(pfx)\n    await exec(path.join(vendorPath, \"pvk2pfx.exe\"), [\"-pvk\", pvk, \"-spc\", cer, \"-pfx\", pfx])\n    log(`${pfx} created. Please see https://electron.build/code-signing how to use it to sign.`)\n\n    const certLocation = \"Cert:\\\\LocalMachine\\\\TrustedPeople\"\n    log(`${pfx} will be imported into ${certLocation} Operation will be succeed only if runned from root. Otherwise import file manually.`)\n    await spawn(\"powershell.exe\", [\"Import-PfxCertificate\", \"-FilePath\", `\"${pfx}\"`, \"-CertStoreLocation\", \"\"])\n  }\n  finally {\n    await tmpDir.cleanup()\n  }\n}"]}
